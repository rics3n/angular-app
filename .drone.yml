image: rics3n/angular:latest

cache:
  - /tmp/npm
  - /tmp/bower

script:
  - npm config set cache /tmp/npm --global
  - npm install --cache /tmp/npm && bower install --allow-root --config.storage.packages=/tmp/bower
  - gulp build

publish:
  docker:
    docker_host: tcp://172.16.1.1:2375
    registry_login_url: $$DOCKER_HUB
    image_name: $$DOCKER_HUB/angular_app
    username: $$DOCKER_PRIVATE_USERNAME
    password: $$DOCKER_PRIVATE_PW
    email: $$DOCKER_PRIVATE_EMAIL
    keep_build: false
    registry_login: true
    docker_version: 1.8.3
    tags:
      - latest
      - $(git rev-parse --short HEAD)
    when:
      branch: master
